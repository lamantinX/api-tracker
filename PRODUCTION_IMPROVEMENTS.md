# Production-Ready –£–ª—É—á—à–µ–Ω–∏—è API Watcher

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. ‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ URL –ø–ª–æ—Ö–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è
- **–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `aiohttp` –∏ `asyncio` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ URL –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞

### 2. üîÑ Retry –º–µ—Ö–∞–Ω–∏–∑–º
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö
- **–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `--max-retries`, `--retry-delay`

### 3. üìä Health Check —Å–∏—Å—Ç–µ–º–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–†–µ—à–µ–Ω–∏–µ**: 
  - CLI health check (`health_check.py`)
  - HTTP endpoint (`health_server.py`)
  - –§–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è (`health.json`)
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: Docker, Kubernetes, systemd

### 4. üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `print` –≤–º–µ—Å—Ç–æ proper logging
- **–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –º–æ–¥—É–ª—å `logging` —Å:
  - –£—Ä–æ–≤–Ω—è–º–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - –†–æ—Ç–∞—Ü–∏–µ–π —Ñ–∞–π–ª–æ–≤
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—ã–≤–æ–¥–æ–º

### 5. üõ°Ô∏è Graceful Shutdown
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏
- **–†–µ—à–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–¥—ã –≤—ã—Ö–æ–¥–∞

## –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `api_watcher/main.py` - –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `api_watcher/health_check.py` - CLI health check
- `api_watcher/health_server.py` - HTTP health endpoint

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- `api_watcher/monitor.sh` - –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è cron
- `api_watcher/crontab.example` - –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cron
- `install.sh` - –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è production

### Deployment
- `docker-compose.yml` - –û–±–Ω–æ–≤–ª–µ–Ω —Å health checks
- `Dockerfile` - –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `k8s-deployment.yaml` - Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
- `api_watcher.service` - Systemd —Å–µ—Ä–≤–∏—Å

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
python main.py --help
  --max-retries N      # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3)
  --retry-delay N      # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1.0)
  --max-concurrent N   # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)
  --health-check       # –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –≤—ã–π—Ç–∏
```

## Health Check endpoints

```bash
# CLI –ø—Ä–æ–≤–µ—Ä–∫–∞
python health_check.py [--max-age 60] [--json] [--quiet]

# HTTP endpoint
curl http://localhost:8080/health[?max_age=120]
```

## –ö–æ–¥—ã –≤—ã—Ö–æ–¥–∞

- `0` - –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (healthy)
- `1` - –ß–∞—Å—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ (degraded/warning)  
- `2` - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (unhealthy/error)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Docker
```bash
docker-compose up -d
curl http://localhost:8080/health
```

### Kubernetes
```bash
kubectl apply -f k8s-deployment.yaml
kubectl get pods -l app=api-watcher
```

### Systemd
```bash
sudo ./install.sh
sudo systemctl start api-watcher
sudo systemctl status api-watcher
```

### Cron
```bash
cp api_watcher/crontab.example /tmp/cron
crontab /tmp/cron
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ 5 URL –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –°–µ–º–∞—Ñ–æ—Ä –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–≥—Ä—É–∑–∫–∏
- –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

### Retry —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 1s, 2s, 4s, 8s...
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ URL
- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ health.json
- –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏/–Ω–µ—É–¥–∞—á

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Docker
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ Kubernetes
- Systemd security features
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–Ω–∏
- `DEBUG` - –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `INFO` - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `WARNING` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- `ERROR` - –û—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –†–æ—Ç–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ logrotate
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- –°–∂–∞—Ç–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Prometheus (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
- Health endpoint —Å–æ–≤–º–µ—Å—Ç–∏–º —Å Prometheus

### Grafana (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å)  
- –î–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ health checks

### Notification webhooks
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ monitor.sh
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Slack/Discord/Teams

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏

1. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
   ```bash
   pip install aiohttp>=3.9.0
   ```

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞**: –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±

4. **Production deployment**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ú–µ—Ç—Ä–∏–∫–∏**: –î–æ–±–∞–≤–∏—Ç—å Prometheus –º–µ—Ç—Ä–∏–∫–∏
2. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: Dashboard –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. **API**: REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
4. **–ü–ª–∞–≥–∏–Ω—ã**: –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è –ø–∞—Ä—Å–µ—Ä–æ–≤
5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞